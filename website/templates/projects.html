{% load static %}
<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Projekty - KN ONYKS</title>

    <!-- Ładowanie stylów -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
      integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog=="
      crossorigin="anonymous"
    />
    <link rel="icon" href="{% static 'images/ico.ico' %}" type="image/png" />

    <!-- Ładowanie skryptów -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- Przekazanie galerii z Django do JavaScript -->
    <script>
      const galleries = {{ galleries_json|safe }};
    </script>
  </head>
  <body>
    <!-- Nagłówek -->
    {% include 'header.html' %}

    <section class="projects">
      {% for project in projects %}
      <div class="project" data-movie="{{ project.slug }}">
        {% if project.get_thumbnail %}
        <img src="{{ project.get_thumbnail }}" alt="Zdjęcie projektu" />
        {% else %}
        <img src="{{ project.get_thumbnail }}" alt="Zdjęcie projektu" />
        {% endif %}

        <div class="overview">
          <h3>{{ project.name }}</h3>
          <p>{{ project.description }}</p>
        </div>
      </div>
      {% endfor %}

      <!-- Nakładka galerii -->
      <div id="galleryOverlay" class="gallery-overlay">
        <span id="closeGallery" class="close-gallery">&times;</span>
        <div id="galleryContent" class="gallery-content slider">
          <!-- Obrazy galerii będą dodawane dynamicznie przez JavaScript -->
        </div>
      </div>
    </section>

    <!-- Stopka -->
    {% include 'footer.html' %}

    <!-- Skrypty -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const menuIcon = document.getElementById("menu-icon");
        const navLinks = document.getElementById("nav-links");

        if (menuIcon && navLinks) {
          menuIcon.addEventListener("click", function () {
            navLinks.classList.toggle("show");
            console.log("Menu icon clicked, toggling 'show' class.");
          });
        }

        function showGallery(projectKey) {
          if (typeof galleries === "undefined") {
            console.error("Zmienna 'galleries' nie została zdefiniowana.");
            return;
          }

          const images = galleries[projectKey];

          if (!images || images.length === 0) {
            console.warn("Brak galerii dla projektu:", projectKey);
            return;
          }

          $("#galleryContent").empty();

          images.forEach(function (src) {
            $("#galleryContent").append(
              `<div><img src="${src}" alt="Gallery Image" /></div>`
            );
          });

          if ($("#galleryContent").hasClass("slick-initialized")) {
            $("#galleryContent").slick("unslick");
          }

          $("#galleryContent").slick({
            infinite: true,
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: true,
            dots: true,
            adaptiveHeight: true,
            centerMode: true,
            centerPadding: "0px",
          });

          $("#galleryOverlay").css("display", "flex");
        }

        $(".project img").on("click", function () {
          if (window.innerWidth > 1230) {
            const projectKey = $(this).closest(".project").data("movie");
            showGallery(projectKey);
          }
        });

        $(".project img").on("dblclick", function () {
          if (window.innerWidth <= 1230) {
            const projectKey = $(this).closest(".project").data("movie");
            showGallery(projectKey);
          }
        });

        $("#closeGallery").on("click", function () {
          $("#galleryOverlay").css("display", "none");
          if ($("#galleryContent").hasClass("slick-initialized")) {
            $("#galleryContent").slick("unslick");
          }
        });

        $("#galleryOverlay").on("click", function (e) {
          if (e.target === this) {
            $(this).css("display", "none");
            if ($("#galleryContent").hasClass("slick-initialized")) {
              $("#galleryContent").slick("unslick");
            }
          }
        });
      });
    </script>
  </body>
</html>
